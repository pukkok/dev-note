"use strict";(self.webpackChunkdev_note=self.webpackChunkdev_note||[]).push([[237],{8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var o=t(6540);const r={},s=o.createContext(r);function a(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(s.Provider,{value:n},e.children)}},9251:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"formtok/route-guard","title":"\uc124\ubb38 \ubcc0\uacbd\uc0ac\ud56d \ub77c\uc6b0\ud305 \uac00\ub4dc","description":"\uc124\ubb38\uc870\uc0ac \uc791\uc131 \uc911 \ub2e4\ub978 \ud0ed\uc73c\ub85c \uc774\ub3d9\ud558\uac70\ub098 \uc885\ub8cc\uc2dc \ubc29\uc5b4\ud574\uc8fc\ub294 \uc5ed\ud560\uc785\ub2c8\ub2e4.","source":"@site/project/formtok/route-guard.md","sourceDirName":"formtok","slug":"/formtok/route-guard","permalink":"/dev-note/project/formtok/route-guard","draft":false,"unlisted":false,"editUrl":"https://github.com/pukkok/dev-note/edit/main/project/formtok/route-guard.md","tags":[],"version":"current","frontMatter":{"title":"\uc124\ubb38 \ubcc0\uacbd\uc0ac\ud56d \ub77c\uc6b0\ud305 \uac00\ub4dc"},"sidebar":"sidebar","previous":{"title":"\uc2dc\uc791\ud558\uae30","permalink":"/dev-note/project/formtok/intro"},"next":{"title":"\ucf54\uc5b4","permalink":"/dev-note/project/react-merge-table/core"}}');var r=t(4848),s=t(8453);const a={title:"\uc124\ubb38 \ubcc0\uacbd\uc0ac\ud56d \ub77c\uc6b0\ud305 \uac00\ub4dc"},l="\uc124\ubb38 \ubcc0\uacbd\uc0ac\ud56d \ub77c\uc6b0\ud305 \uac00\ub4dc",i={},d=[{value:"1. ModalContainer.jsx",id:"1-modalcontainerjsx",level:3},{value:"\uc124\uba85",id:"\uc124\uba85",level:4},{value:"2. useRouteGuard.jsx",id:"2-userouteguardjsx",level:3},{value:"\uc124\uba85",id:"\uc124\uba85-1",level:4},{value:"3. Sidebar.jsx",id:"3-sidebarjsx",level:3},{value:"\uc124\uba85",id:"\uc124\uba85-2",level:4}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\uc124\ubb38-\ubcc0\uacbd\uc0ac\ud56d-\ub77c\uc6b0\ud305-\uac00\ub4dc",children:"\uc124\ubb38 \ubcc0\uacbd\uc0ac\ud56d \ub77c\uc6b0\ud305 \uac00\ub4dc"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\uc124\ubb38\uc870\uc0ac \uc791\uc131 \uc911 \ub2e4\ub978 \ud0ed\uc73c\ub85c \uc774\ub3d9\ud558\uac70\ub098 \uc885\ub8cc\uc2dc \ubc29\uc5b4\ud574\uc8fc\ub294 \uc5ed\ud560\uc785\ub2c8\ub2e4."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"1-modalcontainerjsx",children:"1. ModalContainer.jsx"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"'use client'\n\nimport React, { useEffect, useState, useCallback, useImperativeHandle } from 'react'\nimport ReactDOM from 'react-dom'\nimport useOutsideClick from '@/hooks/useOutsideClick'\n\nconst ModalContainer = ({ children, ref }) => {\n  const [mounted, setMounted] = useState(false)\n  const [modalRoot, setModalRoot] = useState(null)\n  const [enableEscapeClose, setEnableEscapeClose] = useState(true) // ESC\ud0a4 \ub2eb\uae30 \ud5c8\uc6a9 \uc5ec\ubd80\n\n  const { isOpen, setIsOpen, ref: modalContentRefInternal } = useOutsideClick(false)\n\n  useEffect(() => {\n    setMounted(true)\n    let modalRootEl = document.getElementById('modal-root')\n\n    if (!modalRootEl) {\n      modalRootEl = document.createElement('div')\n      modalRootEl.setAttribute('id', 'modal-root')\n      document.body.appendChild(modalRootEl)\n    }\n    setModalRoot(modalRootEl)\n  }, [])\n\n  useImperativeHandle(ref, () => ({\n    open: () => setIsOpen(true),\n    close: () => setIsOpen(false),\n    setEscapeEnabled: (enabled) => setEnableEscapeClose(enabled)\n  }), [setIsOpen])\n\n  const handleEscapeKey = useCallback(e => {\n    if (e.key === 'Escape' && isOpen && enableEscapeClose) setIsOpen(false)\n  }, [isOpen, setIsOpen, enableEscapeClose])\n\n  useEffect(() => {\n    if (isOpen) {\n      window.addEventListener('keydown', handleEscapeKey)\n      if (modalContentRefInternal.current) {\n        modalContentRefInternal.current.focus()\n      }\n    }\n    return () => {\n      window.removeEventListener('keydown', handleEscapeKey)\n    }\n  }, [isOpen, handleEscapeKey, modalContentRefInternal])\n\n  if (!mounted || !modalRoot || !isOpen) return null\n\n  const childrenWithProps = React.Children.map(children, child =>\n    React.isValidElement(child)\n      ? React.cloneElement(child, { onClose: () => setIsOpen(false) })\n      : child\n  )\n\n  const modalContent = (\n    <div className=\"fixed top-0 left-0 w-screen h-screen bg-black/20 dark:bg-black/70 z-[1000]\">\n      <div\n        ref={modalContentRefInternal}\n        tabIndex={-1}\n        className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 outline-none\"\n      >\n        {childrenWithProps}\n      </div>\n    </div>\n  )\n\n  return ReactDOM.createPortal(modalContent, modalRoot)\n}\n\nexport default ModalContainer\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\uc124\uba85",children:"\uc124\uba85"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\ubaa8\ub2ec\uc758 \uae30\ubcf8 \uace8\uaca9 \ucef4\ud3ec\ub10c\ud2b8"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud654\uba74 \ucd5c\uc0c1\ub2e8\uc5d0 ",(0,r.jsx)(n.strong,{children:"\ud3ec\ud0c8"}),"\ub85c \ub80c\ub354\ub9c1\ud558\uba70, \ubc30\uacbd\uc744 \ubc18\ud22c\uba85\uc73c\ub85c \uc5b4\ub461\uac8c \ucc98\ub9ac\ud574 \ubaa8\ub2ec \uc601\uc5ed\uc744 \ub744\uc6c0"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useOutsideClick"})," \ud6c5\uc73c\ub85c \uc678\ubd80 \ud074\ub9ad \uc2dc \ub2eb\uae30, \uc5f4\ub9bc \uc0c1\ud0dc \uad00\ub9ac"]}),"\n",(0,r.jsx)(n.li,{children:"\ubd80\ubaa8 \ucef4\ud3ec\ub10c\ud2b8\uac00 ref\ub85c \ubaa8\ub2ec\uc744 \uc9c1\uc811 \uc5f4\uace0 \ub2eb\uac70\ub098 ESC \ud0a4 \ub2eb\uae30 \ud5c8\uc6a9 \uc5ec\ubd80\ub97c \uc81c\uc5b4 \uac00\ub2a5"}),"\n",(0,r.jsx)(n.li,{children:"ESC\ud0a4 \ub20c\ub800\uc744 \ub54c \ub2eb\uae30 \uae30\ub2a5 \ud3ec\ud568"}),"\n",(0,r.jsx)(n.li,{children:"\ubaa8\ub2ec \ub0b4 \ud3ec\ucee4\uc2a4 \uac15\uc81c \uc774\ub3d9\uc73c\ub85c \uc811\uadfc\uc131 \ud5a5\uc0c1"}),"\n",(0,r.jsx)(n.li,{children:"\uc790\uc2dd \ucef4\ud3ec\ub10c\ud2b8\uc5d0\uac8c onClose \ud504\ub85c\ud37c\ud2f0\ub97c \uc790\ub3d9 \uc8fc\uc785\ud574 \ub2eb\uae30 \ud568\uc218 \uacf5\uc720"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\uc0ac\uc6a9\ucc98"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\ub2e4\ub978 \ucef4\ud3ec\ub10c\ud2b8\uc5d0\uc11c \uacf5\ud1b5 \ubaa8\ub2ec UI\ub85c \uc7ac\uc0ac\uc6a9 \uac00\ub2a5"}),"\n",(0,r.jsx)(n.li,{children:"ref.open(), ref.close(), ref.setEscapeEnabled(bool) \ud638\ucd9c\ud574 \uc81c\uc5b4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"2-userouteguardjsx",children:"2. useRouteGuard.jsx"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"'use client'\n\nimport { useEffect, useRef } from 'react'\nimport { usePathname, useRouter } from 'next/navigation'\nimport { useFormEditStore } from '@/stores/useFormEditStore'\n\nconst useRouteGuard = () => {\n  const router = useRouter()\n  const pathname = usePathname()\n  const modalRef = useRef(null)\n  const nextPath = useRef(null)\n\n  const isModified = useFormEditStore(s => s.isModified)\n  const resetOriginData = useFormEditStore(s => s.resetOriginData)\n\n  const handleRouteChange = (path) => {\n    if (!isModified()) {\n      router.push(path)\n      return false\n    } else {\n      nextPath.current = path\n      modalRef.current?.open()\n      return true\n    }\n  }\n\n  const confirmNavigation = () => {\n    if(!nextPath.current) {\n      if(pathname?.startsWith('/my-form/edit')) {\n        nextPath.current = '/my-form/manage'\n      }\n    }\n    \n    resetOriginData()\n    router.push(nextPath.current)\n    modalRef.current?.close()\n    return nextPath.current\n  }\n\n  useEffect(() => {\n    const handleBeforeUnload = (e) => {\n      if (!isModified()) return\n      e.preventDefault()\n      e.returnValue = ''\n    }\n\n    window.addEventListener('beforeunload', handleBeforeUnload)\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload)\n    }\n  }, [isModified])\n\n  useEffect(() => {\n    const onPopState = () => {\n      if (!isModified()) return router.push('/my-form/manage')\n      modalRef.current?.open()\n    }\n    window.addEventListener('popstate', onPopState)\n    return () => window.removeEventListener('popstate', onPopState)\n  }, [isModified, pathname])\n\n  return {\n    modalRef,\n    handleRouteChange,\n    confirmNavigation,\n  }\n}\n\nexport default useRouteGuard\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\uc124\uba85-1",children:"\uc124\uba85"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\uc800\uc7a5\ub418\uc9c0 \uc54a\uc740 \ubcc0\uacbd\uc0ac\ud56d\uc774 \uc788\uc744 \ub54c \ub77c\uc6b0\ud305\uc744 \uc81c\uc5b4\ud558\ub294 \ud6c5"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"handleRouteChange(path)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\ubcc0\uacbd\uc0ac\ud56d \uc5c6\uc73c\uba74 \uc989\uc2dc \uc774\ub3d9"}),"\n",(0,r.jsx)(n.li,{children:"\uc788\uc73c\uba74 \uc774\ub3d9 \uc608\uc815 \uacbd\ub85c \uc800\uc7a5 \ud6c4 \ubaa8\ub2ec \uc5f4\uc5b4 \uacbd\uace0"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"confirmNavigation()"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\ubaa8\ub2ec \ud655\uc778 \uc2dc \ud638\ucd9c, \ubcc0\uacbd\uc0ac\ud56d \ucd08\uae30\ud654 \ud6c4 \uc2e4\uc81c \uc774\ub3d9 \uc218\ud589"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"\uc0c8\ub85c\uace0\uce68\ud560 \ub54c beforeunload \uc774\ubca4\ud2b8\ub85c \uacbd\uace0\ucc3d \ud45c\uc2dc"}),"\n",(0,r.jsx)(n.li,{children:"\ube0c\ub77c\uc6b0\uc800 \ub4a4\ub85c\uac00\uae30(\ud31d\uc2a4\ud14c\uc774\ud2b8) \uc2dc\uc5d0\ub3c4 \ubcc0\uacbd\uc0ac\ud56d \uc788\uc73c\uba74 \ubaa8\ub2ec \ub744\uc6c0"}),"\n",(0,r.jsx)(n.li,{children:"\ubaa8\ub2ec \uc81c\uc5b4\uc6a9 modalRef \ubc18\ud658\ud558\uc5ec, \ubaa8\ub2ec \uc5f4\uae30/\ub2eb\uae30 \ud638\ucd9c \uac00\ub2a5"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"3-sidebarjsx",children:"3. Sidebar.jsx"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'import SidebarWrapper from "./compoents/SideBarWrapper"\nimport SidebarHeader from "./compoents/SidebarHeader"\nimport UserInfoBox from "./compoents/UserInfoBox"\nimport SidebarNavs from "./compoents/SidebarNavs"\nimport useRouteGuard from "@/hooks/useRouteGuard"\nimport ModalContainer from "@/components/Modal/ModalContainer"\nimport UnSavedAlertModal from "./compoents/UnSavedAlertModal"\nimport { useScreenStore } from "@/stores/useScreenStore"\nimport { useEffect } from "react"\nimport { usePathname } from "next/navigation"\n\nconst Sidebar = () => {\n  const pathname = usePathname()\n  const { modalRef, handleRouteChange, confirmNavigation } = useRouteGuard()\n\n  const setActiveTab = useScreenStore(s => s.setActiveTab) \n\n  const confirmAction = () => {\n    const next = confirmNavigation()\n    setActiveTab(next)\n  }\n\n  useEffect(() => {\n    modalRef.current?.setEscapeEnabled(false)\n    return () => modalRef.current?.setEscapeEnabled(true)\n  }, [])\n\n  useEffect(() => {\n    setActiveTab(pathname)\n  },[])\n\n  return (\n    <SidebarWrapper>\n      <SidebarHeader />\n      <SidebarNavs handleRouteChange={handleRouteChange}/>\n      <footer className="mt-auto">\n        <UserInfoBox />\n      </footer>\n\n      <ModalContainer ref={modalRef}>\n        <UnSavedAlertModal onConfirm={confirmAction}/>\n      </ModalContainer>\n    </SidebarWrapper>\n  )\n}\n\nexport default Sidebar\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\uc124\uba85-2",children:"\uc124\uba85"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\uc0ac\uc774\ub4dc\ubc14 UI \ucef4\ud3ec\ub10c\ud2b8\ub85c, \uba54\ub274 \ub0b4\ube44\uac8c\uc774\uc158\uacfc \uc0ac\uc6a9\uc790 \uc815\ubcf4 \ud45c\uc2dc \ud3ec\ud568"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useRouteGuard"})," \ud6c5\uc744 \ud65c\uc6a9\ud574 \uc774\ub3d9 \uc2dc \ubcc0\uacbd\uc0ac\ud56d \ud655\uc778 \ubaa8\ub2ec \ub744\uc6c0"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SidebarNavs"}),"\uc5d0 ",(0,r.jsx)(n.code,{children:"handleRouteChange"})," \uc804\ub2ec\ud574 \uba54\ub274 \ud074\ub9ad \uc2dc \uacbd\ub85c \uc774\ub3d9 \uc81c\uc5b4"]}),"\n",(0,r.jsxs)(n.li,{children:["\ubaa8\ub2ec \uc5f4\ub9b4 \ub54c ESC\ud0a4 \ub2eb\uae30 \ube44\ud65c\uc131\ud654 (",(0,r.jsx)(n.code,{children:"setEscapeEnabled(false)"}),") \u2014 \uc911\uc694!"]}),"\n",(0,r.jsxs)(n.li,{children:["\ubaa8\ub2ec \ub0b4 \ud655\uc778 \uc2dc ",(0,r.jsx)(n.code,{children:"confirmAction"})," \uc2e4\ud589, \uc2e4\uc81c \ub77c\uc6b0\ud305 \ubc0f \ud0ed \uc0c1\ud0dc \ubcc0\uacbd"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ModalContainer"}),"\uc640 \uacbd\uace0 \ubaa8\ub2ec(",(0,r.jsx)(n.code,{children:"UnSavedAlertModal"}),") \ud3ec\ud568"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);