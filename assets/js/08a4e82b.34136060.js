"use strict";(self.webpackChunkdev_note=self.webpackChunkdev_note||[]).push([[455],{7545:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"kinder-moumi/backend/auth","title":"1. \uc778\uc99d\uacfc \uad8c\ud55c","description":"kinder-moumi \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c\ub294 JWT \uae30\ubc18\uc758 \uc778\uc99d \uc2dc\uc2a4\ud15c\uc744 \ub3c4\uc785\ud558\uc5ec \uc0ac\uc6a9\uc790 \ub85c\uadf8\uc778 \uc0c1\ud0dc\ub97c \uc548\uc804\ud558\uac8c \uc720\uc9c0\ud558\uace0, \uad00\ub9ac\uc790 \uc804\uc6a9 \uae30\ub2a5\uc5d0 \ub300\ud55c \uc811\uadfc\uc744 \uc81c\uc5b4\ud569\ub2c8\ub2e4.","source":"@site/project/kinder-moumi/backend/auth.md","sourceDirName":"kinder-moumi/backend","slug":"/kinder-moumi/backend/auth","permalink":"/dev-note/project/kinder-moumi/backend/auth","draft":false,"unlisted":false,"editUrl":"https://github.com/pukkok/dev-note/edit/main/project/kinder-moumi/backend/auth.md","tags":[],"version":"current","frontMatter":{"title":"1. \uc778\uc99d\uacfc \uad8c\ud55c"},"sidebar":"sidebar","previous":{"title":"react-merge-table \uc801\uc6a9 \uc0ac\ub840","permalink":"/dev-note/project/kinder-moumi/frontend/merge-table"},"next":{"title":"2. \ud30c\uc77c \uc5c5\ub85c\ub4dc","permalink":"/dev-note/project/kinder-moumi/backend/upload-customizing"}}');var i=s(4848),d=s(8453);const t={title:"1. \uc778\uc99d\uacfc \uad8c\ud55c"},c="\uc778\uc99d\uacfc \uad8c\ud55c (Authentication & Authorization)",o={},l=[{value:"\u2705 \uc8fc\uc694 \uae30\uc220 \uc2a4\ud0dd",id:"-\uc8fc\uc694-\uae30\uc220-\uc2a4\ud0dd",level:2},{value:"1. JWT \ud1a0\ud070 \ubc1c\uae09 (<code>auth.js</code>)",id:"1-jwt-\ud1a0\ud070-\ubc1c\uae09-authjs",level:2},{value:"\uc0ac\uc6a9\uc790\uac00 \ub85c\uadf8\uc778 \uc2dc",id:"\uc0ac\uc6a9\uc790\uac00-\ub85c\uadf8\uc778-\uc2dc",level:3},{value:"2. \uc778\uc99d \ubbf8\ub4e4\uc6e8\uc5b4 (<code>isAuth</code>)",id:"2-\uc778\uc99d-\ubbf8\ub4e4\uc6e8\uc5b4-isauth",level:2},{value:"\uc801\uc6a9 \uc608\uc2dc:",id:"\uc801\uc6a9-\uc608\uc2dc",level:3},{value:"3. \uad00\ub9ac\uc790 \uad8c\ud55c \ubbf8\ub4e4\uc6e8\uc5b4 (<code>isAdmin</code>)",id:"3-\uad00\ub9ac\uc790-\uad8c\ud55c-\ubbf8\ub4e4\uc6e8\uc5b4-isadmin",level:2},{value:"4. \ud68c\uc6d0\uac00\uc785 \uc720\ud6a8\uc131 \uac80\uc0ac (<code>validator.js</code>)",id:"4-\ud68c\uc6d0\uac00\uc785-\uc720\ud6a8\uc131-\uac80\uc0ac-validatorjs",level:2},{value:"\uc608: \uc0ac\uc6a9\uc790 ID \uac80\uc99d",id:"\uc608-\uc0ac\uc6a9\uc790-id-\uac80\uc99d",level:3},{value:"\uc608: \ud328\uc2a4\uc6cc\ub4dc \uac80\uc99d",id:"\uc608-\ud328\uc2a4\uc6cc\ub4dc-\uac80\uc99d",level:3},{value:"\uc815\ub9ac",id:"\uc815\ub9ac",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\uc778\uc99d\uacfc-\uad8c\ud55c-authentication--authorization",children:"\uc778\uc99d\uacfc \uad8c\ud55c (Authentication & Authorization)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"kinder-moumi"})," \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c\ub294 JWT \uae30\ubc18\uc758 \uc778\uc99d \uc2dc\uc2a4\ud15c\uc744 \ub3c4\uc785\ud558\uc5ec \uc0ac\uc6a9\uc790 \ub85c\uadf8\uc778 \uc0c1\ud0dc\ub97c \uc548\uc804\ud558\uac8c \uc720\uc9c0\ud558\uace0, \uad00\ub9ac\uc790 \uc804\uc6a9 \uae30\ub2a5\uc5d0 \ub300\ud55c \uc811\uadfc\uc744 \uc81c\uc5b4\ud569\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-\uc8fc\uc694-\uae30\uc220-\uc2a4\ud0dd",children:"\u2705 \uc8fc\uc694 \uae30\uc220 \uc2a4\ud0dd"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"JWT (JSON Web Token)"}),": \uc0ac\uc6a9\uc790 \uc778\uc99d \uc815\ubcf4 \ud1a0\ud070\ud654"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"express-validator"}),": \uc785\ub825\uac12 \uc720\ud6a8\uc131 \uac80\uc99d"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ubbf8\ub4e4\uc6e8\uc5b4 \ud328\ud134"}),": \uc778\uc99d \ubc0f \uad8c\ud55c \uac80\uc99d \ud750\ub984 \uad6c\uc131"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"1-jwt-\ud1a0\ud070-\ubc1c\uae09-authjs",children:["1. JWT \ud1a0\ud070 \ubc1c\uae09 (",(0,i.jsx)(n.code,{children:"auth.js"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"\uc0ac\uc6a9\uc790 \ub85c\uadf8\uc778 \uc131\uacf5 \uc2dc \uc11c\ubc84\ub294 \ub2e4\uc74c \uc815\ubcf4\ub97c \ud3ec\ud568\ud55c JWT \ud1a0\ud070\uc744 \ubc1c\uae09\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const generateToken = (user) => {\n  return jwt.sign({\n    _id: user._id,\n    organization: user.organization,\n    kinderCode: user.kinderCode,\n    name: user.name,\n    userId: user.userId,\n    createdAt: user.createdAt,\n    isAdmin: user.isAdmin\n  }, config.JWT_SECRET, {\n    expiresIn: '1d',\n    issuer: '\ud479\uace1\uc88c'\n  })\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\uc0ac\uc6a9\uc790\uac00-\ub85c\uadf8\uc778-\uc2dc",children:"\uc0ac\uc6a9\uc790\uac00 \ub85c\uadf8\uc778 \uc2dc"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"teachers.js"}),"\uc758 ",(0,i.jsx)(n.code,{children:"/login"})," \ub77c\uc6b0\ud2b8\ub97c \ud1b5\ud574 ",(0,i.jsx)(n.code,{children:"userId"}),"\uc640 ",(0,i.jsx)(n.code,{children:"password"}),"\ub85c \uc778\uc99d"]}),"\n",(0,i.jsxs)(n.li,{children:["\uc131\uacf5 \uc2dc JWT \ud1a0\ud070\uc744 \ubc18\ud658\ud558\uba70, \uc774\ud6c4 \ubaa8\ub4e0 API \uc694\uccad\uc758 ",(0,i.jsx)(n.code,{children:"Authorization"})," \ud5e4\ub354\uc5d0 \ud1a0\ud070 \ud3ec\ud568"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"2-\uc778\uc99d-\ubbf8\ub4e4\uc6e8\uc5b4-isauth",children:["2. \uc778\uc99d \ubbf8\ub4e4\uc6e8\uc5b4 (",(0,i.jsx)(n.code,{children:"isAuth"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["\uc0ac\uc6a9\uc790\uac00 \ubcf4\ub0b8 JWT \ud1a0\ud070\uc744 \uac80\uc99d\ud558\uace0, \uc720\ud6a8\ud560 \uacbd\uc6b0 \uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c ",(0,i.jsx)(n.code,{children:"req.user"}),"\uc5d0 \uc800\uc7a5\ud569\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const isAuth = (req, res, next) => {\n  const bearerToken = req.headers.authorization\n  if (!bearerToken) {\n    return res.status(401).json({ code: 401, msg: '\ud1a0\ud070\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.' })\n  }\n  const token = bearerToken.slice(7)\n  jwt.verify(token, config.JWT_SECRET, (err, userInfo) => {\n    if (err && err.name === 'TokenExpiredError') {\n      return res.status(419).json({ code: 419, msg: '\ud1a0\ud070\uc774 \ub9cc\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.' })\n    } else if (err) {\n      return res.status(401).json({ code: 401, msg: '\uc720\ud6a8\ud55c \ud1a0\ud070\uc774 \uc544\ub2d9\ub2c8\ub2e4.' })\n    }\n    req.user = userInfo\n    next()\n  })\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\uc801\uc6a9-\uc608\uc2dc",children:"\uc801\uc6a9 \uc608\uc2dc:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"app.use('/platform', isAuth, isAdmin, uploader)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"3-\uad00\ub9ac\uc790-\uad8c\ud55c-\ubbf8\ub4e4\uc6e8\uc5b4-isadmin",children:["3. \uad00\ub9ac\uc790 \uad8c\ud55c \ubbf8\ub4e4\uc6e8\uc5b4 (",(0,i.jsx)(n.code,{children:"isAdmin"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["\uc0ac\uc6a9\uc790\uac00 \uad00\ub9ac\uc790 \uad8c\ud55c(",(0,i.jsx)(n.code,{children:"isAdmin: true"}),")\uc744 \uac00\uc9c0\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const isAdmin = (req, res, next) => {\n  if (req.user && req.user.isAdmin) {\n    next()\n  } else {\n    return res.status(401).json({ code: 401, msg: '\ub2f9\uc2e0\uc740 \uad00\ub9ac\uc790\uac00 \uc544\ub2c8\uc5c8\uc2b5\ub2c8\ub2e4!' })\n  }\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"4-\ud68c\uc6d0\uac00\uc785-\uc720\ud6a8\uc131-\uac80\uc0ac-validatorjs",children:["4. \ud68c\uc6d0\uac00\uc785 \uc720\ud6a8\uc131 \uac80\uc0ac (",(0,i.jsx)(n.code,{children:"validator.js"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"\ud68c\uc6d0\uac00\uc785 \uc2dc \uc785\ub825\uac12\uc5d0 \ub300\ud574 \uc815\uaddc\uc2dd \uae30\ubc18\uc758 \uc720\ud6a8\uc131 \uac80\uc0ac\ub97c \uc218\ud589\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.h3,{id:"\uc608-\uc0ac\uc6a9\uc790-id-\uac80\uc99d",children:"\uc608: \uc0ac\uc6a9\uc790 ID \uac80\uc99d"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const validateUserId = () => {\n  return check('userId')\n    .notEmpty()\n    .isLength({ min: 2, max: 20 })\n    .matches(/[a-zA-Z]/)\n    .matches(/[0-9]/)\n    .withMessage('\uc544\uc774\ub514\ub294 \uc601\ubb38\uacfc \uc22b\uc790\ub97c \ud3ec\ud568\ud574\uc57c \ud569\ub2c8\ub2e4.')\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\uc608-\ud328\uc2a4\uc6cc\ub4dc-\uac80\uc99d",children:"\uc608: \ud328\uc2a4\uc6cc\ub4dc \uac80\uc99d"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const validateUserPassword = () => {\n  return body('password')\n    .isLength({ min: 7, max: 15 })\n    .matches(/[!@#$%^&*]/)\n    .withMessage('\ud2b9\uc218\ubb38\uc790\ub97c \ud3ec\ud568\ud574\uc57c \ud569\ub2c8\ub2e4.')\n    .custom((value, { req }) => value === req.body.confirmPassword)\n    .withMessage('\ud328\uc2a4\uc6cc\ub4dc\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.')\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\uc815\ub9ac",children:"\uc815\ub9ac"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ub85c\uadf8\uc778 \uc2dc JWT \ubc1c\uae09 \ubc0f \ud504\ub860\ud2b8 \uc804\ub2ec"}),"\n",(0,i.jsxs)(n.li,{children:["\ubaa8\ub4e0 \uc778\uc99d\uc774 \ud544\uc694\ud55c API\ub294 ",(0,i.jsx)(n.code,{children:"isAuth"}),"\ub97c \ud1b5\ud574 \ubcf4\ud638\ub428"]}),"\n",(0,i.jsxs)(n.li,{children:["\uad00\ub9ac\uc790 \uc804\uc6a9 API\ub294 ",(0,i.jsx)(n.code,{children:"isAdmin"}),"\uc744 \ucd94\uac00\ub85c \uc0ac\uc6a9"]}),"\n",(0,i.jsxs)(n.li,{children:["\uc0ac\uc6a9\uc790 \uc785\ub825\uc740 ",(0,i.jsx)(n.code,{children:"express-validator"}),"\ub85c \uc0ac\uc804 \uac80\uc99d"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["\uc774 \uad6c\uc870\ub294 ",(0,i.jsx)(n.strong,{children:"\ube44\ub85c\uadf8\uc778 \uc0ac\uc6a9 \uad8c\ud55c \uc81c\ud55c"}),", ",(0,i.jsx)(n.strong,{children:"\uad00\ub9ac\uc790 \uae30\ub2a5 \uad6c\ubd84"}),", ",(0,i.jsx)(n.strong,{children:"\uc785\ub825\uac12 \uc720\ud6a8\uc131 \ubcf4\uc7a5"}),"\uc744 \ub3d9\uc2dc\uc5d0 \ub2ec\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \uc124\uacc4\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var r=s(6540);const i={},d=r.createContext(i);function t(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);